<!doctype html>
<html lang="pt-BR" class="scroll-smooth">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>fakeapi — recursos e exemplos</title>

  <!-- Prevenir FOUC do tema -->
  <script>
    (function(){
      try {
        const saved = localStorage.getItem('fakeapi_theme');
        const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
        const isDark = saved ? saved === 'dark' : prefersDark;
        if (isDark) document.documentElement.classList.add('dark');
      } catch {}
    })();
  </script>

  <script src="https://cdn.tailwindcss.com"></script>
  <script> tailwind.config = { darkMode: 'class' } </script>

  <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 128 128'%3E%3Crect width='128' height='128' rx='20' fill='%236d28d9'/%3E%3Cpath d='M64 26l38 21v42L64 102 26 89V47z' fill='white'/%3E%3C/svg%3E">
</head>
<body class="bg-slate-50 text-slate-800 dark:bg-slate-900 dark:text-slate-100">
  <!-- Header -->
  <header class="sticky top-0 z-30 border-b border-slate-200/60 dark:border-slate-800/60 backdrop-blur bg-white/70 dark:bg-slate-900/70">
    <div class="max-w-5xl mx-auto px-4 py-3 relative">
      <div class="flex items-center justify-between gap-3">
        <!-- Brand -->
        <a href="#" class="flex items-center gap-3">
          <span class="inline-flex h-9 w-9 items-center justify-center rounded-xl bg-gradient-to-br from-violet-600 to-pink-500 text-white shadow-md shadow-violet-500/20">
            <svg viewBox="0 0 24 24" class="h-5 w-5" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 3l7 4v10l-7 4-7-4V7z"/><path d="M12 12l7-4"/></svg>
          </span>
          <div>
            <h1 class="text-base font-bold leading-5">fakeapi</h1>
            <p class="text-xs text-slate-500 dark:text-slate-400 leading-4">API REST para protótipos e testes</p>
          </div>
        </a>

        <!-- Desktop controls -->
        <div class="hidden md:flex flex-wrap items-center gap-2">
          <input data-role="baseInput"
                 class="w-[260px] sm:w-[320px] rounded-lg border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-800 px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-violet-500"
                 placeholder="https://fakeapi.aioher.com" aria-label="Base URL da API">
          <button data-role="detectBtn" class="rounded-lg border border-slate-300 dark:border-slate-700 px-3 py-2 text-sm hover:bg-slate-100 dark:hover:bg-slate-800">Detectar</button>
          <button data-role="reloadBtn" class="rounded-lg border border-slate-300 dark:border-slate-700 px-3 py-2 text-sm hover:bg-slate-100 dark:hover:bg-slate-800">Recarregar</button>
          <button data-role="themeBtn" class="rounded-lg bg-violet-600 text-white px-3 py-2 text-sm hover:bg-violet-700">Tema</button>
        </div>

        <!-- Mobile: hamburger -->
        <button id="navToggle" aria-controls="mobileMenu" aria-expanded="false"
                class="md:hidden inline-flex items-center justify-center rounded-lg border border-slate-300 dark:border-slate-700 p-2 text-slate-700 dark:text-slate-200 hover:bg-slate-100 dark:hover:bg-slate-800"
                aria-label="Abrir menu">
          <svg class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M4 6h16M4 12h16M4 18h16"/>
          </svg>
        </button>
      </div>

      <!-- Mobile panel -->
      <div id="mobileMenu" class="md:hidden hidden absolute left-0 right-0 top-full mt-2">
        <div class="rounded-2xl border border-slate-200 dark:border-slate-800 bg-white/95 dark:bg-slate-900/95 shadow-xl backdrop-blur p-3 space-y-2">
          <label class="block text-xs text-slate-500 dark:text-slate-400 px-1">Base URL</label>
          <input data-role="baseInput"
                 class="w-full rounded-lg border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-800 px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-violet-500"
                 placeholder="https://fakeapi.aioher.com" aria-label="Base URL da API (mobile)">
          <div class="grid grid-cols-3 gap-2">
            <button data-role="detectBtn" class="rounded-lg border border-slate-300 dark:border-slate-700 px-3 py-2 text-sm hover:bg-slate-100 dark:hover:bg-slate-800">Detectar</button>
            <button data-role="reloadBtn" class="rounded-lg border border-slate-300 dark:border-slate-700 px-3 py-2 text-sm hover:bg-slate-100 dark:hover:bg-slate-800">Recarregar</button>
            <button data-role="themeBtn" class="rounded-lg bg-violet-600 text-white px-3 py-2 text-sm hover:bg-violet-700">Tema</button>
          </div>
          <a id="apiLink" href="#" target="_blank" rel="noopener" class="block text-xs text-pink-600 dark:text-pink-400 hover:underline px-1">abrir API</a>
        </div>
      </div>
    </div>
  </header>

  <!-- Main -->
  <main class="max-w-5xl mx-auto px-4 py-8 grid lg:grid-cols-[1.05fr,0.95fr] gap-6">
    <!-- Recursos -->
    <section class="rounded-2xl border border-slate-200 dark:border-slate-800 bg-white dark:bg-slate-800/70 shadow-sm">
      <div class="p-5 border-b border-slate-200 dark:border-slate-800">
        <div class="flex items-center justify-between">
          <h2 class="text-lg font-semibold">Recursos disponíveis</h2>
          <!-- API link duplicado é controlado pelo do menu mobile -->
        </div>
        <p id="status" class="mt-1 text-xs text-slate-500 dark:text-slate-400">Carregando…</p>
      </div>
      <ul id="list" class="p-3 divide-y divide-slate-200/70 dark:divide-slate-800/70">
        <li class="px-3 py-3 text-sm text-slate-500">Carregando…</li>
      </ul>
    </section>

    <!-- Docs rápidos -->
    <section class="rounded-2xl border border-slate-200 dark:border-slate-800 bg-white dark:bg-slate-800/70 shadow-sm">
      <div class="p-5 border-b border-slate-200 dark:border-slate-800">
        <h2 class="text-lg font-semibold">Como usar</h2>
        <p class="mt-1 text-sm text-slate-600 dark:text-slate-300">
          Retorno padrão é um <b>array</b>. Para incluir metadados (<code class="text-xs bg-slate-100 dark:bg-slate-900/60 px-1 py-0.5 rounded">page</code>, <code class="text-xs bg-slate-100 dark:bg-slate-900/60 px-1 py-0.5 rounded">total</code>), use <code class="text-xs bg-slate-100 dark:bg-slate-900/60 px-1 py-0.5 rounded">?_meta=1</code>.
        </p>
      </div>
      <div class="p-5 space-y-4">
        <div>
          <div class="text-xs uppercase tracking-wide text-slate-500 dark:text-slate-400 mb-2">Endpoints</div>
          <div class="text-sm text-slate-700 dark:text-slate-200 flex flex-wrap gap-2">
            <code class="px-1.5 py-0.5 rounded bg-slate-100 dark:bg-slate-900/60">GET /:resource</code>
            <code class="px-1.5 py-0.5 rounded bg-slate-100 dark:bg-slate-900/60">GET /:resource/:id</code>
            <code class="px-1.5 py-0.5 rounded bg-slate-100 dark:bg-slate-900/60">POST /:resource</code>
            <code class="px-1.5 py-0.5 rounded bg-slate-100 dark:bg-slate-900/60">PUT /:resource/:id</code>
            <code class="px-1.5 py-0.5 rounded bg-slate-100 dark:bg-slate-900/60">PATCH /:resource/:id</code>
            <code class="px-1.5 py-0.5 rounded bg-slate-100 dark:bg-slate-900/60">DELETE /:resource/:id</code>
          </div>
        </div>

        <details class="rounded-xl border border-slate-200 dark:border-slate-800 p-4">
          <summary class="cursor-pointer font-medium">Parâmetros</summary>
          <ul class="mt-2 text-sm text-slate-700 dark:text-slate-200 space-y-1">
            <li><code class="bg-slate-100 dark:bg-slate-900/60 px-1 py-0.5 rounded text-xs">?_page=1</code> + <code class="bg-slate-100 dark:bg-slate-900/60 px-1 py-0.5 rounded text-xs">?_limit=10</code> — paginação (usa header <code class="text-xs">X-Total-Count</code>).</li>
            <li><code class="bg-slate-100 dark:bg-slate-900/60 px-1 py-0.5 rounded text-xs">?q=texto</code> — busca textual.</li>
            <li><code class="bg-slate-100 dark:bg-slate-900/60 px-1 py-0.5 rounded text-xs">?_meta=1</code> — retorna <code class="text-xs">{ data, meta }</code>.</li>
          </ul>
          <p class="mt-2 text-xs text-slate-500 dark:text-slate-400">Problemas de CORS? Libere a origem do site na variável <code>CORS_ORIGIN</code> ou sirva esta página no mesmo domínio da API.</p>
        </details>

        <details class="rounded-xl border border-slate-200 dark:border-slate-800 p-4">
          <summary class="cursor-pointer font-medium">Exemplos (cURL)</summary>
          <div class="mt-3 relative">
            <button id="copyCurl" class="absolute right-2 top-2 rounded-md border border-slate-300 dark:border-slate-700 bg-white/80 dark:bg-slate-900/60 text-xs px-2 py-1 hover:bg-slate-100 dark:hover:bg-slate-800">Copiar</button>
            <pre id="curlExamples" class="text-xs leading-5 bg-slate-900 text-slate-100 rounded-lg p-3 overflow-auto shadow-inner">
# LISTAR (array)
curl https://fakeapi.aioher.com/posts

# LISTAR paginado + meta
curl "https://fakeapi.aioher.com/posts?_page=1&_limit=5&_meta=1"

# DETALHE
curl https://fakeapi.aioher.com/posts/1

# CRIAR
curl -X POST https://fakeapi.aioher.com/posts \
  -H "Content-Type: application/json" \
  -d '{"title":"Novo post","body":"conteúdo"}'
            </pre>
          </div>
        </details>
      </div>
    </section>
  </main>

  <!-- Footer -->
  <footer class="border-t border-slate-200 dark:border-slate-800">
    <div class="max-w-5xl mx-auto px-4 py-6 text-sm text-slate-600 dark:text-slate-300 flex flex-wrap items-center gap-x-4 gap-y-2">
      <span>MIT © <span id="year"></span> fakeapi</span>
      <span class="hidden sm:inline">•</span>
      <span class="inline-flex items-center gap-2">
        Forks: <strong id="forks">—</strong>
        <a class="underline decoration-dotted hover:text-pink-600 dark:hover:text-pink-400" href="https://github.com/samuelikz/fakeapi/fork" target="_blank" rel="noopener">Fazer fork</a>
      </span>
      <span class="hidden sm:inline">•</span>
      <a class="underline decoration-dotted hover:text-pink-600 dark:hover:text-pink-400" href="https://fakeapi.aioher.com/" target="_blank" rel="noopener">fakeapi.aioher.com</a>
      <span class="hidden sm:inline">•</span>
      <a class="underline decoration-dotted hover:text-pink-600 dark:hover:text-pink-400" href="https://github.com/samuelikz/fakeapi" target="_blank" rel="noopener">Repositório</a>
    </div>
  </footer>

  <script>
    const $  = (s) => document.querySelector(s);
    const $$ = (s) => [...document.querySelectorAll(s)];

    const listEl   = $('#list');
    const statusEl = $('#status');
    const apiLink  = $('#apiLink'); // do menu mobile
    const navToggle= $('#navToggle');
    const mobileMenu = $('#mobileMenu');

    // --- Navbar mobile toggle ---
    function closeMenu(){ mobileMenu.classList.add('hidden'); navToggle.setAttribute('aria-expanded','false'); }
    function openMenu(){ mobileMenu.classList.remove('hidden'); navToggle.setAttribute('aria-expanded','true'); }
    navToggle.addEventListener('click', () => {
      const open = navToggle.getAttribute('aria-expanded') === 'true';
      open ? closeMenu() : openMenu();
    });
    window.addEventListener('keydown', (e)=>{ if(e.key==='Escape') closeMenu(); });
    window.addEventListener('click', (e)=>{ if(!mobileMenu.contains(e.target) && !navToggle.contains(e.target)) closeMenu(); });

    // --- Tema (desktop + mobile) ---
    $$('.js-theme-btn, [data-role="themeBtn"]').forEach(btn=>{
      btn.addEventListener('click', () => {
        const isDark = document.documentElement.classList.toggle('dark');
        try { localStorage.setItem('fakeapi_theme', isDark ? 'dark' : 'light'); } catch {}
      });
    });

    // --- Base URL (múltiplos inputs) ---
    const baseInputs = $$('[data-role="baseInput"]');

    function defaultBase() {
      if (location.hostname.endsWith('aioher.com')) return location.origin;
      return 'https://fakeapi.aioher.com';
    }
    function setBase(u) {
      const clean = (u || '').replace(/\/$/, '');
      baseInputs.forEach(inp => inp.value = clean);
      if (apiLink){ apiLink.href = clean || '#'; apiLink.textContent = (clean || '').replace(/^https?:\/\//,'') || 'defina a Base URL'; }
      // atualizar exemplos
      $('#curlExamples').textContent =
`# LISTAR (array)
curl ${clean}/posts

# LISTAR paginado + meta
curl "${clean}/posts?_page=1&_limit=5&_meta=1"

# DETALHE
curl ${clean}/posts/1

# CRIAR
curl -X POST ${clean}/posts \\
  -H "Content-Type: application/json" \\
  -d '{"title":"Novo post","body":"conteúdo"}'`;
      try { localStorage.setItem('fakeapi_base', clean); } catch {}
    }
    setBase(localStorage.getItem('fakeapi_base') || defaultBase());
    baseInputs.forEach(inp => inp.addEventListener('change', (e)=> setBase(e.target.value)));

    // Helpers
    async function getJSON(url, { timeout = 8000 } = {}) {
      const ctrl = new AbortController();
      const to = setTimeout(() => ctrl.abort(), timeout);
      try {
        const res = await fetch(url, { signal: ctrl.signal, headers: { 'Accept': 'application/json' }});
        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        const ct = res.headers.get('content-type') || '';
        return ct.includes('json') ? res.json() : res.text();
      } finally { clearTimeout(to); }
    }
    function itemLabel(n) { return n === 1 ? 'item' : 'itens'; }
    function currentBase(){ return (baseInputs[0]?.value || '').replace(/\/$/,''); }

    function renderResources(base, rows) {
      listEl.innerHTML = '';
      if (!rows.length) {
        listEl.innerHTML = `<li class="px-3 py-3 text-sm text-slate-500">Nenhum recurso encontrado.</li>`;
        statusEl.textContent = 'OK, sem recursos.';
        return;
      }
      rows.forEach(({ name, count }) => {
        const safeCount = Number(count ?? 0);
        const li = document.createElement('li');
        li.className = "px-3 py-3 hover:bg-slate-50 dark:hover:bg-slate-900/40 transition-colors";
        li.innerHTML = `
          <div class="flex items-center justify-between gap-3">
            <a class="font-medium text-pink-600 dark:text-pink-400 hover:underline" href="${base}/${name}" target="_blank" rel="noopener">/${name}</a>
            <span class="text-xs text-slate-500 dark:text-slate-400">${safeCount} ${itemLabel(safeCount)}</span>
          </div>`;
        listEl.appendChild(li);
      });
      statusEl.innerHTML = '<span class="text-emerald-600 dark:text-emerald-400">Recursos carregados.</span>';
    }

    async function loadResources() {
      const base = currentBase();
      listEl.innerHTML = `<li class="px-3 py-3 text-sm text-slate-500">Carregando…</li>`;
      statusEl.textContent = 'Carregando…';
      try {
        const rows = await getJSON(`${base}/__resources`);
        if (Array.isArray(rows)) return renderResources(base, rows);
      } catch {}
      try {
        const rows2 = await getJSON(`${base}/_resources`);
        if (Array.isArray(rows2)) return renderResources(base, rows2);
      } catch {}
      try {
        const posts = await getJSON(`${base}/posts`);
        if (Array.isArray(posts)) return renderResources(base, [{ name: 'posts', count: posts.length }]);
      } catch {}
      listEl.innerHTML = `<li class="px-3 py-3 text-sm text-rose-600">Falha ao carregar recursos.</li>`;
      statusEl.innerHTML = 'Erro ao buscar. <span class="text-rose-600">Pode ser CORS</span>: libere a origem do site na API (<code class="text-xs">CORS_ORIGIN</code>) ou hospede esta página no mesmo domínio.';
    }

    async function detect() {
      const base = currentBase();
      statusEl.textContent = 'Testando /health…';
      try {
        await getJSON(`${base}/health`, { timeout: 5000 });
        statusEl.innerHTML = '<span class="text-emerald-600 dark:text-emerald-400">/health OK</span>';
        setBase(base);
        loadResources();
      } catch {
        statusEl.innerHTML = '<span class="text-rose-600">/health falhou</span>. Verifique a URL e CORS.';
      }
    }

    // Ações UI (desktop + mobile)
    $$('[data-role="detectBtn"]').forEach(b => b.addEventListener('click', detect));
    $$('[data-role="reloadBtn"]').forEach(b => b.addEventListener('click', loadResources));

    // Copiar cURL
    $('#copyCurl').addEventListener('click', async () => {
      try {
        await navigator.clipboard.writeText($('#curlExamples').textContent);
        const btn = $('#copyCurl'); const prev = btn.textContent; btn.textContent = 'Copiado!';
        setTimeout(() => btn.textContent = prev, 1200);
      } catch {}
    });

    // Forks
    fetch('https://api.github.com/repos/samuelikz/fakeapi')
      .then(r => r.ok ? r.json() : Promise.reject())
      .then(meta => { const el = document.getElementById('forks'); if (el) el.textContent = (typeof meta.forks_count === 'number') ? meta.forks_count : '0'; })
      .catch(() => { const el = document.getElementById('forks'); if (el) el.textContent = '—'; });

    // Ano
    const y = document.getElementById('year'); if (y) y.textContent = new Date().getFullYear();

    // Start
    loadResources();
  </script>
</body>
</html>
