name: ğŸ“‹ License Check

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main, develop ]
  schedule:
    # Executa diariamente Ã s 00:00 UTC
    - cron: '0 0 * * *'

jobs:
  license-check:
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ” Checkout code
      uses: actions/checkout@v4
      
    - name: ğŸŸ¢ Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm'
        
    - name: ğŸ“¦ Install dependencies
      run: npm ci
      
    - name: ğŸ” Check license file exists
      run: |
        if [ ! -f "LICENSE" ]; then
          echo "âŒ LICENSE file not found!"
          exit 1
        fi
        echo "âœ… LICENSE file found"
        
    - name: ğŸ” Validate MIT license content
      run: |
        if grep -q "MIT License" LICENSE && grep -q "Copyright (c)" LICENSE; then
          echo "âœ… MIT License content validated"
        else
          echo "âŒ Invalid MIT License content"
          exit 1
        fi
        
    - name: ğŸ” Check package.json license field
      run: |
        LICENSE_FIELD=$(node -p "require('./package.json').license")
        if [ "$LICENSE_FIELD" = "MIT" ]; then
          echo "âœ… Package.json license field is MIT"
        else
          echo "âŒ Package.json license field is not MIT: $LICENSE_FIELD"
          exit 1
        fi
        
    - name: ğŸ” Check README license section
      run: |
        if grep -q "LicenÃ§a MIT" README.md; then
          echo "âœ… README contains MIT license reference"
        else
          echo "âŒ README missing MIT license reference"
          exit 1
        fi
        
    - name: ğŸ“Š License summary
      run: |
        echo "ğŸ“‹ License Check Summary:"
        echo "âœ… LICENSE file exists"
        echo "âœ… MIT License content valid"
        echo "âœ… Package.json license field correct"
        echo "âœ… README license section present"
        echo ""
        echo "ğŸ‰ All license checks passed!"
        
    - name: ğŸš€ License status
      run: |
        echo "ğŸ“„ Project License: MIT"
        echo "ğŸ‘¤ Copyright: Samuel Nunes"
        echo "ğŸ“… Year: 2024"
        echo "ğŸŒ Repository: https://github.com/samuelikz/fakeapi"
